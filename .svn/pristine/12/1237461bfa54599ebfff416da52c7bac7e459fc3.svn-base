<!-- 服务接入申请步骤条 -->
<template>
  <a-layout class="open-layout">
    <div class="body">
      <span class="servicetitle">{{$route.query.code}}</span>
      <a-icon type="close" class="closeicon" @click="closestep" />
      <a-steps :current="current" labelPlacement="vertical" type="navigation" size="small">
        <a-step title="选择接口" description />
        <a-step title="填写资料" description />
        <a-step title="完成" description />
      </a-steps>
      <a-divider />

      <div v-show="current == 0">
        <actionApply ref="actioninfo" :allow="true" @changeCurrent="changeCurrent" />
      </div>
      <div v-show="current == 1">
        <serviceForm ref="formdata" :allow="true" @changeCurrent="changeCurrent" />
      </div>
      <div v-if="current == 2">
        <serviceApplySuccess />
      </div>
    </div>
  </a-layout>
</template>

<script>
import { Layout, Steps, Divider, Icon } from "ant-design-vue";
import ServiceActionApply from "./ServiceActionApply";
import ServiceForm from "./ServiceForm";
import ServiceApplySuccess from "./ServiceApplySuccess";
import { apiModify } from "../../api/service";
export default {
  data() {
    return {
      current: 0
    };
  },
  components: {
    ALayout: Layout,
    ASteps: Steps,
    AStep: Steps.Step,
    ADivider: Divider,
    AIcon: Icon,
    actionApply: ServiceActionApply,
    ServiceForm: ServiceForm,
    ServiceApplySuccess,
    ServiceApplySuccess
  },

  // mounted: {},
  activated() {
    this.current = 0;
  },
  methods: {
    //改变步骤条
    changeCurrent(value) {
      if (this.current === 1 && value === 1) {
        let data = {
          apiIdList: this.$refs.actioninfo.selectedRowKeys,
          appId: this.$store.getters.appInfo.id,
          serviceId: this.$route.query.serviceId,
          desc: this.$refs.actioninfo.desc,
          data: this.$refs.formdata.formdataJson,
          ip: this.$refs.formdata.ip
        };

        apiModify(data)
          .then(res => {
            this.current += value;
          })
          .catch(err => {
            showError(err);
          });
      } else {
        this.current += value;
      }
    },
    //关闭当前窗口，返回上一级
    closestep() {
      this.$router.go(-1);
    }
  }
};
</script>
<style lang='less' scoped>
.open-layout {
  padding: 10px;
  height: 100%;
  .body {
    width: 100%;
    height: 100%;
    padding: 8px 10%;
    margin: 0 auto;
    overflow-y: auto;
    background: #fff;
    .servicetitle {
      position: relative;
      right: 11%;
      font-size: 20px;
    }
    .closeicon {
      float: right;
      position: relative;
      left: 11%;
      font-size: 15px;
      :hover {
        color: @primary-color;
      }
    }
  }
}
/deep/ .ant-steps-item-tail {
  width: 0%;
}
.ant-steps-navigation .ant-steps-item.ant-steps-item-active::before {
  left: 25%;
  width: 50%;
}
.ant-divider-horizontal {
  margin-top: 0;
  margin-bottom: 25px;
}
.ant-steps-navigation {
  padding-top: 15px;
}
</style>