<template>
  <div class="issue-tracking">
    <div class="main">
      <div class="main-top">
        <div class="tabs">
          <a 
            v-for="(item, index) in tabs" 
            :key="index"
            :class="{active: active && active.text == item.text}"
            @click="active = item"
          >
            {{item.text}}
          </a>
        </div>
        <div class="org-select">
          <a-input
            style="width: 200px"
            :value="orgValue && orgValue.name"
            :read-only="true"
            placeholder="请选择机构"
            @click="showOrgSelect"
          >
            <a-icon slot="addonAfter" type="select" @click="showOrgSelect"/>
          </a-input>
        </div>
      </div>
      <div class="main-chart">
        <div v-show="showChart" class="g2-chart">
          <div class="g2-chart-top">
            <div class="left">
              <donut-chart 
                :district="district"
                :title="title"
                >
              </donut-chart>
              <donut-chart 
                :district="district"
                :title="title"
                :handlestatus=0
                >
              </donut-chart>
            </div>
            <div class="right">
              <stacked-bar-chart 
                :district="district"
                :title="title"
                :handlestatus=0
                >
              </stacked-bar-chart>
            </div>
          </div>
          <div class="g2-chart-bottom">
            <line-chart
              :district="district"
              :title="title"
              >
            </line-chart>
          </div>
        </div>
        <table-list
          :district="district"
          :orgid="orgValue && orgValue._id"
        >
        </table-list>
      </div>  
    </div>
    <!-- 机构选择弹框 -->
    <a-modal
      :footer="null"
      v-model="orgvisible"
      :width="500"
      title="选择单位"
      :bodyStyle="{ height: '600px', padding: '0'}"
    >
      <org-user-select mode="org" 
        @finish="orgOk" 
      />
    </a-modal>
  </div>
</template>
<script>
import { Row, Col, Input, Icon, Table, Pagination, Button, Modal } from "ant-design-vue";
import { Donut, Line, StackedBar } from '@antv/g2plot';
import { problemmonitorCount } from "@/person-shaoxing/api/monitor";
import OrgUserSelect from "@/framework/components/OrgUserSelect";
import DonutChart from "./DonutChart";
import StackedBarChart from "./StackedBarChart";
import LineChart from "./LineChart";
import TableList from "./TableList";
import { showError } from '../../../../framework/utils';
export default {
  name: '',
  components: {
    ARow: Row,
    ACol: Col,
    AInput: Input,
    AIcon: Icon,
    ATable: Table,
    AButton: Button,
    APagination: Pagination,
    AModal: Modal,
    OrgUserSelect,
    DonutChart,
    StackedBarChart,
    LineChart,
    TableList
  },
  data() {
    return {
      district: undefined,
      active: undefined,
      orgValue: undefined,
      orgvisible: false,
      title: '绍兴市',
      showChart: true
    }
  },
  computed: {
    tabs() {
      let arr = [{ key: 'shaoxingshi', text: '全部', value: undefined }],
          d = this.$store.getters.dict("usermanage.org.district");
      return arr.concat(d || []);
    },
  },
  watch: {
    active: {
      handler(val) {
        this.district = val.value;
        this.orgValue = undefined;
        if(!this.showChart) {
          this.showChart = true;
        }
        switch(val.value) {
          case 1:
            this.title = "市本级";
            break;
          case 2:
            this.title = "越城区";
            break;
          case 3:
            this.title = "上虞区";
            break;
          case 4:
            this.title = "和桥区";
            break;
          case 5:
            this.title = "诸暨市";
            break;
          case 6:
            this.title = "嵊州市";
            break;
          case 7:
            this.title = "新昌县";
            break;
          default:
            this.title = "绍兴市"
        }
      },
    }
  },
  created() {
    this.active = this.tabs[0];
  },
  mounted() {
  },
  methods: {
    showOrgSelect() {
      this.orgvisible = true;
    },
    orgOk(type, list) {
      this.orgvisible = false;
      this.showChart = false;
      if(type == "ok" && list.length > 0) {
        this.orgValue = list[0];
      } 
    }
  }
}
</script>
<style lang="less" scoped>
.issue-tracking{
  padding: 10px;
  height: 100%;
  .main{
    display: flex;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
    -ms-flex-direction: column;
    flex-direction: column;
    overflow: hidden;
    background: @white;
    height: 100%;
    .main-top{
      margin-top: 10px;
      padding: 0 @content-padding-h;
        .tabs{
          padding: @content-padding-v 0;
          a{
            display: inline-block;
            height: 26px;
            line-height: 26px;
            padding: 0 12px;
            margin-left: 6px;
            border-radius: @border-radius-base;
            &:first-child{
              margin-left: 0;
            }
            &:hover{
              background: @primary-1;
            }
          }
          a.active{
            background-color: @primary-color;
            color: white;
            &:hover{
              background: lighten(@primary-color, 5%);
            }
          }
        }
    }
    .main-chart{
      flex-shrink: 1;
      overflow-y: auto;
      .g2-chart{
        .g2-chart-top{
          display: flex;
          > div{
            width: 50%;
          }
        }
      }
    }
  }
}
</style>