<template>
  <div class="preview-wrap">
    <div class="content">
      <iframe id="external-frame" :class="rotate ? 'coverimg rotate' : 'coverimg'" frameborder="0px" :src="src" scrolling="no"></iframe>
    </div>
  </div>
</template>

<script>
export default {
  name: "TemplatePreview",
  data() {
    return {
      rotate: false,
      src: 'about:blank'
    };
  },
  mounted() {
    if(window.opener){
      let { type, data } = window.opener.paramsBridge;
      if(type == 'templete.preview' && data){
        //TODO 根据页面设置修改样式
        this.rotate = data.rotate;
        this.src = `javascript:void(function(){document.open();document.write('${data.template || ''}');document.close();}())`;
      }
    }
    let that = this;
    window.onload = function() {
      that.setIframeHeight(document.getElementById("external-frame"));
    };
  },
  methods: {
    setIframeHeight(iframe) {
      if (iframe) {
        var iframeWin =
          iframe.contentWindow || iframe.contentDocument.parentWindow;
        if (iframeWin.document.body) {
          iframe.height =
            iframeWin.document.documentElement.scrollHeight ||
            iframeWin.document.body.scrollHeight;
        }
      }
    }
  },
};
</script>
<style lang='less'>
#app {
  background: #eee;
}
.preview-wrap {
  .content {
    background: #eee;
    padding: 30px 0px;
    .coverimg {
      margin-top: 60px;
      width: 769px;
      min-height: 1124px;
      background: #fff;
      display: block;
      margin: 0px auto;
      &.rotate{
        width: 1124px;
        min-height: 769px;
      }
    }
  }
}
</style>