<template>
  <div>
    <a-form-item
      :label="property.desc"
      :required="property.require" 
      :validateStatus="validateStatus"
      :label-col="itemLayout.labelCol" 
      :wrapper-col="itemLayout.wrapperCol"
      >
      <dict-select
        :dict="property.dict"
        style="width: 100"
        v-model="propValue"
        @change="onChange"
        >
      </dict-select>
    </a-form-item>
  </div>
</template>

<script>
import { Form } from "ant-design-vue";
import DictSelect from "@/framework/components/DictSelect";
import set from 'lodash/set';
export default {
  props: {
    property: {
      type: Object
    },
    itemLayout: {
      type: Object
    }
  },
  components: {
    AFormItem: Form.Item,
    DictSelect
  },
  data() {
    return {
      propValue: undefined,
      validateStatus: undefined
    };
  },
  watch: {},
  computed: {},
  created() {},
  mounted() {},
  methods: {
    validateField(obj){
      return new Promise((resolve, reject) => {
        this.validate((error) => {
          if(error){
            reject(error);
          }else{
            set(obj, this.property.name, this.propValue === undefined ? null : this.propValue);
            resolve();
          }
        })
      });
    },
    validate(callback){
      let status = undefined, error;
      if(this.property.require && (!this.propValue && this.propValue !== 0)){
        status = 'error';
        error = `请填写${this.property.desc}`;
      }else{
        status = 'success';
      }
      this.validateStatus = status;
      if(callback){
        callback(error);
      }
    },
    onChange(){
      this.validate();
    }
  },
};
</script>
<style lang="less" scoped>
</style>