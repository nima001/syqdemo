
import { Schema } from '@formily/vue'
import { randomStr } from "@/framework/utils/index";

export function addProperty(schema, prop, index){
  const name = prop.name || randomStr(6);
  const empty = schema.properties === undefined;
  let addSchema;
  if(index >= 0){
    const props = Schema.getOrderProperties(schema);
    addSchema = schema.addProperty(name, prop);
    for(; index < props.length; index ++){//FIXME sunwen 属性调顺 x-index 处理麻烦（properties直接赋值无法更新关联数据）
      let { key, schema: s } = props[index];
      schema.removeProperty(key);
      schema.addProperty(key, s)
    }
  }else{
    addSchema = schema.addProperty(name, prop);
  }
  if(empty && schema.parent){//FIXME sunwen 属性为空时无法更新关联数据
    schema.parent.properties[schema.name] = schema;
  }
  return addSchema;
}

/**
 * 将自己移除，返回被移除的Schema
 * @param {*} schema 
 */
export function removeSelf(schema){
  return schema.parent.removeProperty(schema.name);
}

/**
 * 获取Schema在父属性列表中的索引
 * @param {*} schema 
 */
export function indexOfParent(schema){
  if(schema.parent){
    const props = Schema.getOrderProperties(schema.parent);
    return props.findIndex(item => item.key == schema.name);
  }else{
    return -1;
  }
}

/**
 * 属性个数
 * @param {*} schema 
 */
export function propsSize(schema){
  if(schema && schema.properties){
    return Object.keys(schema.properties).length;
  }
  return 0
}