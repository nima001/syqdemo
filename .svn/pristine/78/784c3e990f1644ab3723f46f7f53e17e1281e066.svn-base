import request from '@/framework/utils/request'

/**
 * 人员调动列表查询
 * data对象属性
 * @param {int} nodeid 组织节点id
 * @param {enum} type  1: 调入   2:调出
 * @param {String} searchkey 查询字符串
 * @param {int} nodeid 组织节点id
 * @param {String} starttime 开始时间
 * @param {String} endtime 结束时间
 */
export function transferList (data) {
  return request({
    url: '/hall2/personneltransfer/query',
    method: 'post',
    data: data
  })
}

/** **********************  组织数相关接口 *************************/
// 获取组织树
export function treepath (id, treeid) {
  return request({
    url: '/hall2/orgtree/path',
    method: 'get',
    params: {
      id,
      treeid
    }
  })
}
// 组织树节点搜索
export function treequery (data) {
  return request({
    url: '/hall2/orgtree/query',
    method: 'post',
    data
  })
}
// 获取组织结构
export function treeroot (treeid) {
  return request({
    url: '/hall2/orgtree/root',
    method: 'get',
    params: {
      treeid
    }
  })
}

// 获取组织下机构情况
export function listnode (id, treeid) {
  return request({
    url: '/hall2/orgtree/listnode',
    method: 'get',
    params: {
      pid: id,
      treeid: treeid
    }
  })
}

// 组织查询
export function orgquery (data) {
  return request({
    url: '/hall2/org/query',
    method: 'post',
    dataType: 'json',
    data
  })
}

/** **********************  组织操作相关接口 *************************/

/**
 * 获取组织下节点列表
 * @param {int} pid  父节点id
 * @param {Object} pagination 分页对象
 * @returns
 */
export function neworgquery (data) {
  return request({
    url: '/hall2/orgtree/query',
    method: 'post',
    dataType: 'json',
    data
  })
}

/**
 * 新增组织
 * @param {int} pid  父节点id
 * @param {String} name 组织名称
 * @param {orgphone} orgphone 组织电话
 * @param {Dict} orgtype 组织类型(字典类型)
 */
export function orgcreate (data) {
  return request({
    url: '/hall2/org/create',
    method: 'post',
    dataType: 'json',
    data
  })
}

/**
 * @export
 * @param {String}  dataid 创建的父节点数据id
 * @param {name} name 组织名称
 * @param {Dict} orgtype 组织类型(字典类型)
 * @param {int} pid 父节点id
 * @param {int} type 节点类型  1 : 数据   0 :分类
 */
export function catalognodequery (data) {
  return request({
    url: '/hall2/catalognode/query',
    method: 'post',
    dataType: 'json',
    data
  })
}

// 删除组织
export function orgdelete (data) {
  return request({
    url: '/hall2/org/delete' + data,
    method: 'post',
    dataType: 'json'
  })
}

// 删除节点
export function deletebatch (data) {
  return request({
    url: '/hall2/catalognode/deletebatch' + data,
    method: 'post',
    dataType: 'json'
  })
}

// 更新组织
export function orgupdate (id, data) {
  return request({
    url: '/hall2/org/update/' + id,
    method: 'post',
    dataType: 'json',
    data
  })
}

/** **********************  人员操作相关接口 *************************/

// 个人
// 个人查询
export function userquery (data) {
  return request({
    url: '/hall2/user/query',
    method: 'post',
    dataType: 'json',
    data
  })
}

// 人员信息
export function getUser (id) {
  return request({
    url: '/hall2/user/' + id,
    method: 'get'
  })
}

// 更新人员信息
export function updateUser (id, data) {
  if (data.dept && Object.keys(data.dept).length == 0) {
    data.dept = null
  }
  if (data.work && data.work.length) {
    data.work.forEach(element => {
      if (element.workdept && Object.keys(element.workdept).length == 0) {
        element.workdept = null
      }
    })
  }
  return request({
    url: '/hall2/user/' + id,
    method: 'post',
    dataType: 'json',
    data
  })
}

// 获取模型的表单
export function modelForm (model, userId) {
  return request({
    url: `/hall2/modelprops/form/${model}?id=${userId}`,
    method: 'get'
  })
}

// 用户查询导出
export function getexport (data, properties, title) {
  return request({
    url:
      '/hall2/user/query/export?title=' +
      encodeURIComponent(title) +
      '&properties=' +
      encodeURIComponent(properties),
    method: 'post',
    dataType: 'json',
    data
  })
}

// 组织查询导出
export function orgexport (data) {
  return request({
    url: '/hall2/org/export',
    method: 'post',
    dataType: 'json',
    data
  })
}
