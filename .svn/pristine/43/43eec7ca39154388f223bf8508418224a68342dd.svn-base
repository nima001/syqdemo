<template>
  <div class="column-chart" ref="columnChart">
    <div class="chart-title">{{title}}</div>
    <div class="table">
      <div id="container"></div>
    </div>
  </div>
</template>

<script>
import { GroupedColumn } from '@antv/g2plot';
export default {
  name: 'ColumnChart',
  props: ['chartData', 'pagetype'],
  data() {
    return {
      datalist: [],
      columnPlot: null,
      title: ''
    }
  },
  watch: {
    chartData: {
      handler(val) {
        this.datalist = [].concat(val);
        this.columnPlot.changeData(this.datalist);
      },
      deep: true
    },
    pagetype: {
      handler(val) {
        if(val == 1) {
          this.title = '编制数和实有数';
        }else if(val == 2) {
          this.title = '编外控制数和实有人数';
        }else if(val == 5) {
          this.title = '机构职责调整数';
        }else if(val == 6) {
          this.title = '出（入）编业务办理情况';
        }else if(val == 8) {
          this.title = '用编计划情况';
        }
      },
      immediate: true
    }
  },
  mounted() {
    this.init();
  },
  methods:{
    area(key){
      let d = this.$store.getters.dictKey("usermanage.org.district", key);
      return (d && d.text) || '';
    },
    init() {
      this.columnPlot = new GroupedColumn(document.getElementById('container'), {
        title: {
          visible: false
        },
        forceFit: true,
        data: this.datalist,
        meta: {// 坐标轴处理
          xname: {
            alias: 'xname',
            formatter:(v)=>{
              return this.area(v);
            }
          }
        },
        xField: 'xname',
        yField: 'value',
        xAxis: {
          title: {
            visible: false,
          },
          line: {
            visible: true
          },
          grid: {
            visible: true
          },
        },
        yAxis: {
          title: {
            visible: false,
          },
          line: {
            visible: true
          },
          grid: {
            visible: true,
            style: {
              
            }
          },
          min: 0,
        },
        label: {
          visible: true,
        },
        legend: {
          visible: true,
          position: 'bottom'
        },
        groupField: 'fieldname',
        color: ['#D15456', '#5488D1', '#D1BF3D'],
      });

      this.columnPlot.render();
    },
  }
}
</script>

<style lang="less" scoped>
.column-chart{
  height: 100%;
  background: @white;
  .chart-title{
    text-align: center;
    font-size: 20px;
    padding: @content-padding-v 0;
  }
  .table{
    padding: @content-padding-v @content-padding-h;  
    height: 100%;
    #container{
      height: calc(~"100% -  50px");
    }
  }
}
</style>