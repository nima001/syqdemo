<template>
  <div class="wrap">
    <a-form-item
      v-if="formLayout != 'horizontal'"
      :label="name"
      :required="!!required"
      :validateStatus="validateStatus"
    >
      <a-tooltip placement="topLeft" :title="help">
        <a-cascader
          placeholder="请选择籍贯"
          :options="options"
          v-model="propValue"
          :disabled="!!disabled"
          :class="{ notEditor: !editor }"
          :allowClear="true"
          :title="propValue"
        />
      </a-tooltip>
    </a-form-item>
    <a-form-item v-else :required="!!required" :validateStatus="validateStatus">
      <div class="compact">
        <div
          class="title"
          :title="name"
          :class="{ textArea: multiline, required }"
        >
          {{ name }}
        </div>
        <a-tooltip placement="topLeft" :title="help">
          <a-cascader
            placeholder="请选择籍贯"
            :options="options"
            v-model="propValue"
            :disabled="!!disabled"
            :class="{ notEditor: !editor }"
            :allowClear="true"
            :title="propValue"
          />
        </a-tooltip>
      </div>
    </a-form-item>
  </div>
</template>

<script>
/**
 * 级联选择组件 (省市区，组织。。。)
 */
import { Form, Cascader } from "ant-design-vue";
import { mixins } from "@formdesign/views/mixin/index";
import { getRegions } from "@/formdesign/api/index";
import { showError } from "@framework/utils";
export default {
  components: {
    ACascader: Cascader,
    AFormItem: Form.Item,
  },
  mixins: [mixins],
  data() {
    return {
      options: undefined,
    };
  },
  created() {
    this.getRegionsList();
  },
  methods: {
    getRegionsList() {
      let districtPageQuery = {
        // allSub: true,
        // code: "110000000000",
        // county: true,
        needtotal: true,
        // orders: [
        //   {
        //     orderby: "string",
        //     ordertype: "ASC",
        //   },
        // ],
        // pagenum: 0,
        pagesize: 100,
        // searchKey: "String",
        // subordinate: true,
      };
      getRegions(districtPageQuery)
        .then((res) => {
          if (res.code == "success") {
            // console.log(res.result.rows)
            this.options = res.result.rows.map((item) => {
              return { value: item.name, label: item.name, code: item.code };
            });
            // console.log(this.options)
            for (let i = 0; i < this.options.length; i++) {
              districtPageQuery = {
                // allSub: true,
                code: this.options[i].code,
                needtotal: true,
                pagesize: 1000,
              };
              getRegions(districtPageQuery)
                .then((res) => {
                  if (res.code == "success") {
                    // console.log(res.result.rows)
                    this.options[i].children = res.result.rows.map((item) => {
                      // console.log(item)
                      return {
                        value: item.name,
                        label: item.name,
                        code: item.code,
                      };
                    });
                    // console.log(this.options[i].children);
                    if (this.options[i].children.length > 0) {
                      // console.log(this.options[i].children.length);
                      for (
                        let j = 0;
                        j < this.options[i].children.length;
                        j++
                      ) {
                        // console.log(this.options[i].children[j].code);
                        districtPageQuery = {
                          // allSub: true,
                          code: this.options[i].children[j].code,
                          needtotal: true,
                          pagesize: 1000,
                        };
                        // console.log(districtPageQuery)
                        getRegions(districtPageQuery)
                          .then((res) => {
                            // console.log(res)
                            if (res.code == "success") {
                              // console.log(res.result.rows)
                              this.options[i].children[
                                j
                              ].children = res.result.rows.map((item) => {
                                // console.log(item)
                                return {
                                  value: item.name,
                                  label: item.name,
                                  code: item.code,
                                };
                              });
                            }
                          })
                          // .catch((err) => {
                          //   showError(err);
                          // });
                      }
                    }
                  }
                })
                .catch((err) => {
                  showError(err);
                });
            }
            console.log(this.options)
          }
        })
        .catch((err) => {
          showError(err);
        });
    },
  },
};
</script>
<style lang='less' scoped>
//@import url(); 引入公共css类
</style>