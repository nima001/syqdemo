<template>
  <div class="my-state">
    <ul class="newList">
      <li v-for="(item,index) in data" :key="index">
        <span class="dot"></span>
        <div style="cursor: pointer;" class="newsLink" @click="jump(item)">{{item.content}}</div>
        <span class="newDate">{{item.sendtime}}</span>
      </li>
    </ul>
    <div class="data-nodata" v-if="data&&data.length == 0">
      <template>
        <empty-data></empty-data>
      </template>
    </div>
  </div>
</template>
<script>
import { Card } from "ant-design-vue";
import {
  msglist,
  msgreadMark,
  msgtopMark,
  msgdelmsg,
  systemlist,
} from "../api/message";
import { showError, dateFormat } from "@/framework/utils/index";
import EmptyData from "@/framework/components/EmptyData";

export default {
  data() {
    return {
      data: [],
    };
  },
  components: {
    ACard: Card,
    EmptyData,
  },
  created() {
    this.getMsglist();
  },
  methods: {
    jump(item) {
      window.open(item.pcurl);
      this.read(item.messageid);
    },
    read(messageid) {
      msgreadMark({
        mark: 1,
        messageid,
      })
        .then((res) => {
          this.getMsglist();
        })
        .catch((err) => {
          //ignore
        });
    },
    getMsglist() {
      msglist({
        ishandle: 0,
        isread: 0,
        needtotal: true,
        pagenum: 1,
        pagesize: 9,
        type: 3,
      })
        .then(({ result }) => {
          (result.rows || []).forEach((i) => {
            i.sendtime = dateFormat(new Date(i.sendtime), "yyyy-MM-dd");
          });
          this.data = result.rows;
        })
        .catch((err) => {
          showError(err);
        });
    },
  },
};
</script>

<style lang="less" scoped>
.my-state {
  padding: 10px 20px;
  overflow: hidden;
  height: 272px;
  border: none;
  ul.newList {
    padding: 0px;
    margin-bottom: 0px;
    li {
      position: relative;
      display: flex;
      list-style: none;
      align-items: center;
      line-height: 28px;

      &:hover {
        background: @primary-1;
      }
      .dot {
        margin-top: -8px;
        width: 4px;
        height: 4px;
        background: @accent-color;
        border-radius: 50%;
      }
      .newsLink {
        width: 80%;
        height: 28px;
        font-size: 14px;
        padding: 0px 10px;
        color: #171717;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-decoration: none;
      }
      .newDate {
        position: absolute;
        right: 9px;
        font-size: 12px;
        font-family: Noto Sans S Chinese;
        font-weight: 400;
        color: #595959;
      }
    }
  }
  .data-nodata {
    height: 100%;
  }
}
</style>