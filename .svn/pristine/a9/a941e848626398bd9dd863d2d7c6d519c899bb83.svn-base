<template>
  <div>
    <Title title="人员结构" />
    <div class="container">
      <SwiperChart>
        <div slot="content">
          <div class="title">
            <div class="top">行政人员结构</div>
            <div class="bottom">
              <span>平均年龄</span>
              <span>{{data.xzrypjnl||0}}</span>
            </div>
          </div>
          <div class="chart-detail">
            <div class="chart-content">
              <RingChart
                :data="dataSource"
                :settings="{
                  canvas: { width: 400, height: 145 },
                  padding: [20,0,0,-160],
                  radius: 0.9,
                  innerRadius: 0.8,
                  customLegend: true,
                  infoText: {
                    title: '20岁以下',
                    offsetY: -10,
                    style: { fontSize: 15, fill: '#fff', textAlign: 'center' },
                  },
                  contentStyle: {
                    offsetY: 10,
                    fontSize: 13, fill: '#fff', textAlign: 'center'
                  }
                }"
              />
            </div>
            <div class="chart-content">
              <RingChart
                :data="datacopy"
                :settings="{
                  canvas: { width: 400, height: 145 },
                  padding: [20,0,0,-160],
                  radius: 0.9,
                  innerRadius: 0.8,
                  customLegend: true,
                  infoText: {
                    title: '本科',
                    offsetY: -10,
                    style: { fontSize: 15, fill: '#fff', textAlign: 'center' },
                  },
                  contentStyle: {
                    offsetY: 10,
                    fontSize: 13, fill: '#fff', textAlign: 'center'
                  }
                }"
              />
            </div>
          </div>
        </div>
        <div slot="content">
          <div class="title">
            <div class="top">事业人员结构</div>
            <div class="bottom">
              <span>平均年龄</span>
              <span>{{data.syrypjnl||0}}</span>
            </div>
          </div>
          <div class="chart-detail">
            <div class="chart-content">
              <RingChart
                :data="dataSource"
                :settings="{
                  canvas: { width: 400, height: 145 },
                  padding: [20,0,0,-160],
                  radius: 0.9,
                  innerRadius: 0.8,
                  customLegend: true,
                  infoText: {
                    title: '20岁以下',
                    offsetY: -10,
                    style: { fontSize: 15, fill: '#fff', textAlign: 'center' },
                  },
                  contentStyle: {
                    offsetY: 10,
                    fontSize: 13, fill: '#fff', textAlign: 'center'
                  }
                }"
              />
            </div>
            <div class="chart-content">
              <RingChart
                :data="datacopy"
                :settings="{
                  canvas: { width: 400, height: 145 },
                  padding: [20,0,0,-160],
                  radius: 0.9,
                  innerRadius: 0.8,
                  customLegend: true,
                  infoText: {
                    title: '本科',
                    offsetY: -10,
                    style: { fontSize: 15, fill: '#fff', textAlign: 'center' },
                  },
                  contentStyle: {
                    offsetY: 10,
                    fontSize: 13, fill: '#fff', textAlign: 'center'
                  }
                }"
              />
            </div>
          </div>
        </div>
      </SwiperChart>
    </div>
  </div>
</template>

<script>
import Title from "./Title";
import SwiperChart from './SwiperChart'
import RingChart from "@person/components/chart/RingChart";
import { areaStatistics } from '@/person-shaoxing/api/orgStaffReport'
import { showError } from '../../../../framework/utils';

export default {
  props: {
    districtCode: {
      type: String,
    },
  },
  components: {
    Title,
    RingChart,
    SwiperChart
  },
  data() {
    return {
      dataSource: {
        keyCols: [{ column: "k0", key: "district", showname: "所在地区" }],
        rows: [
          { k0: "20岁以下", v0: 247 },
          { k0: "40-49岁", v0: 247 },
          { k0: "20-29岁", v0: 352 },
          { k0: "50-59岁", v0: 361 },
          { k0: "30-39岁", v0: 305 },
          { k0: "60岁以上", v0: 371 },
        ],
        valueCols: [{ column: "v0", showname: "记录数" }],
      },
      data: {},
      datacopy: {
        keyCols: [{ column: "k0", key: "district", showname: "所在地区" }],
        rows: [
          { k0: "博士", v0: 347 },
          { k0: "硕士", v0: 247 },
          { k0: "本科", v0: 352 },
          { k0: "专科", v0: 361 },
          { k0: "高中", v0: 305 },
          { k0: "中专", v0: 371 },
          { k0: "初中", v0: 371 },
          { k0: "其他", v0: 371 },
        ],
        valueCols: [{ column: "v0", showname: "记录数" }],
      },
    };
  },
  watch: {
    districtCode(val) {
      this.loadData(val);
      return val;
    },
  },
  methods: {
    loadData(district){
      areaStatistics(district, [
        'xzrypjnl', 'syrypjnl'
      ]).then(({result}) => {
        this.data = result;
      }).catch(error => {
        showError(error)
      });
    },
  }
};
</script>

<style scoped lang="less">
@font-face {
  font-family: LESLIEB;
  src: url("../../../assets/img/screen/LESLIEB_.TTF") format("truetype");
}
.container {
  /deep/.ant-carousel .slick-slider {
    padding: 0 @layout-space-base;
    .slick-slide {
      padding: @layout-space-base 0;
      background: fade(#000, 50%);
    }
  }
  .title {
    font-size: 1em;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    .bottom {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-around;
      span:first-child {
        font-weight: 500;
      }
      span:last-child {
        font-size: 1.5em;
        font-family: LESLIEB;
        color: fade(#01e3fc, 95%);
      }
    }
  }
  .chart-detail {
    padding-top: @layout-space-base;
    background: url('../../../assets/img/screen/icon-division.png') no-repeat;
    .chart-content {
      height: 50%;
      margin-bottom: @layout-space-base;
      display: flex;
      flex-direction: column;
      background: url("../../../assets/img/screen/legend-bg.png") no-repeat;
      background-position: 100% 50%;
      /deep/.ring-chart {
        height: 100%;
      }
    }
  }
}
</style>
