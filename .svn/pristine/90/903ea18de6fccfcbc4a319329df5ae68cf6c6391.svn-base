<template>
  <div style="padding: 16px 24px;">
    <div class="select">
      <a-input-search enter-button style="width: 30%;" placeholder="请输入人员名称" @search="searchKeyworlds" />
    </div>

    <a-table
      :columns="columns"
      :dataSource="data"
      :pagination="false"
      :customRow="addTemplate"
      :loading="loading"
    >
      <a
        slot="username"
        slot-scope="username"
        style="color: rgb(0, 0, 0)"
        :title="username"
        >{{ username }}</a
      >

      <a
        slot="orgname"
        slot-scope="orgname"
        style="color: rgb(0, 0, 0)"
        :title="orgname"
        >{{ orgname }}</a
      >

      <a slot="job" slot-scope="job" style="color: rgb(0, 0, 0)" :title="job">{{
        job
      }}</a>

      <a slot="_id" slot-scope="text" @click="detail(text)">编辑</a>
    </a-table>

    <div class="bottom">
      <a-pagination
        v-if="data.length > 0"
        :total="total"
        :showSizeChanger="true"
        @showSizeChange="onShowSizeChange"
        :page-size-options="pageSizeOptions"
        :page-size="pagesize"
        v-model="pagenum"
        @change="onPageChange"
        :showTotal="(total) => `总共：${total}条`"
      ></a-pagination>
    </div>
  </div>
</template>
<script>
const columns = [
  {
    width: "25%",
    title: "姓名",
    dataIndex: "username",
    key: "username",
    scopedSlots: { customRender: "username" },
    align: "center",
  },
  {
    // width: "10%",
    title: "所属组织",
    dataIndex: "orgname",
    key: "orgname",
    scopedSlots: { customRender: "orgname" },
    align: "center",
  },
  {
    // width: "10%",
    title: "职务",
    dataIndex: "job",
    key: "job",
    scopedSlots: { customRender: "job" },
    align: "center",
  },
  {
    title: "操作",
    dataIndex: "_id",
    key: "_id",
    scopedSlots: { customRender: "_id" },
    align: "center",
  },
];
import { userquery } from "@/hall/api/usermanage";
import { Table, Input,Pagination } from "ant-design-vue";
import { showError } from "@framework/utils";
import { mixins } from "@/hall/mixin/index";
export default {
  data() {
    return {
      total: 0,
      pageSizeOptions: ["10", "20", "30", "40", "50"],
      pagesize: 10,
      pagenum: 1,
      columns,
      data: [],
      searchkey: "",
      loading:true,
    };
  },
  components: {
    ATable: Table,
    AInputSearch: Input.Search,
    APagination: Pagination,
  },
  mounted() {
    this.getData(this.nodeData);
  },
  mixins:[mixins],
  methods: {
    addTemplate(record, index) {
      return {
        on: {
          click: () => {
            this.detail(record._id);
          },
        },
      };
    },
    searchKeyworlds(searchkey) {
      this.searchkey = searchkey;
      this.pagenum=1
      this.getData(nodeData);
    },
    getData(nodeData) {
      this.loading=true
      const data = {
        needtotal: true,
        pagenum: this.pagenum,
        pagesize: this.pagesize,
        searchkey: this.searchkey,
        nodeid: nodeData?nodeData.id:'',
      };
      userquery(data).then((res) => {
        this.loading=false
        if (res.code == "success") {
          this.pagesize = res.result.pagesize;
          this.total = res.result.total;
          this.pagenum = res.result.pagenum;
          let data = res.result.rows;
          data.forEach(function (x, y) {
            x.key = y;
            x.orgname=x.org.name
          });
          this.data = data;
        }
      }).catch(error => {
         this.loading=false
        showError(error);
      });
    },
    //pagenum切换
    onPageChange(page, pageSize) {
      this.getData(nodeData);
    },
    //pagesize切换
    onShowSizeChange(current, size) {
      (this.pagesize = size), (this.pagenum = 1);
      this.getData(nodeData);
    },
    detail(id) {
      this.$router.push({ path: "/hall/usermanage/userinfo", query: { userid: id } });
    },
  },
};
</script>
<style lang="less" scoped>
.select {
    // float: right;
  display: flex;
  flex-direction: row-reverse;
  margin-bottom: 12px;
  
}
.bottom {
  padding: @content-padding-v @content-padding-h;
  .ant-pagination {
    margin-top: 10px;
    text-align: right;
  }
}
</style>
