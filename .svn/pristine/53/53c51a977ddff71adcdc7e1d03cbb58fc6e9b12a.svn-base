<template>
  <div class="content">
    <div class="head">
      <span>平均分</span>
      <span class="num">
        <span v-for="(item, index) in aveNum" 
          :class="[{'pointer': isNumber(item, index), 'decimal': index>indexTag}]">
          {{item}}
        </span>
      </span>
    </div>
    <div class="body">
      <table>
        <thead>
          <th class="name">机构名称</th>
          <th>评级</th>
        </thead>
        <tbody>
          <tr v-for="(item,index) in data" :key="item.id" @click="choose(index)" :class="{'active': isActive(index)}">
            <td class="name">{{item.name}}</td>
            <td :class="['grade',{'A': item.current=='A', 'B': item.current=='B', 'C': item.current=='C'}]">
              {{item.current|capitalize}}
              <span>
                <img v-if="show(item)==false" src="../../../assets/img/screen/icon-up.png"/>
                <img v-else-if="show(item)==true" src="../../../assets/img/screen/icon-down.png"/>
                <img v-else alt="">
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <DialogBox v-model="visible" 
      :title="selected && selected.name" 
      :destroyOnClose="true"
    >
      <KpiDetail :org="selected"/>
    </DialogBox>
  </div>
</template>

<script>
import { Space } from 'ant-design-vue';
import DialogBox from './DialogBox'
import KpiDetail from './KpiDetail'

export default {
  components: {
    ASpace: Space,
    DialogBox,
    KpiDetail
  },
  props: {
    data: {
      type: Array,
      defaul:()=>{
        return []
      }
    },
    average: {
      type: Number
    }
  },
  data() {
    return {
      indexTag: undefined,
      active: undefined,
      visible: false,
    };
  },
  filters: {
    capitalize: (value)=> {
      if(value=='A') {
        return '优秀'
      }else if(value=='B') {
        return '良好'
      }else if(value=='C') {
        return '一般'
      }
    }
  },
  computed: {
    aveNum() {
      return this.average.toString().split('');
    }
  },
  methods: {
    isNumber(num, index) {
      if(isNaN(num)) {
        this.indexTag = index;
        return true;
      }
      return false;
    },
    choose(index) {
      this.active = index;
    },
    isActive(index) {
      if(index==this.active) {
        return true
      }
      return false;
    },
    show(item) {
      if(item.last<item.current) {
        return true;
      }else if(item.last>item.current) {
       return false;
      }
    }
  }
};
</script>
<style lang="less" scoped>
.content {
  color: #fff;
  .head {
    height: 57px;
    padding: 0 6%;
    margin: 10px 20px;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: radial-gradient(circle, fade(#0DEEFF, 15%) 0%, fade(#0DEEFF, 5%) 100%);
    position: relative;
    .num {
      font-size: 32px;
      font-weight: bold;
      display: flex;
      align-items: center;
      & span {
        width: 30px;
        height: 43px;
        line-height: 43px;
        margin-right: 8px;
        display: inline-block;
        text-align: center;
        color: #00FFEA;
        background: fade(#fff, 22%);
        &.decimal {
          color: fade(#00FFEA, 60%);
        }
        &.pointer {
          width: 1px;
          line-height: 2.8;
          font-size: 24px;
          font-family: fantasy;
          background: transparent;
          transform: translateX(-185%);
        }
      }
    }
    &::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      left: 0;
      height: 12px;
      background: url("../../../assets/img/screen/radiance-small.png");
    }
    &::after {
      content: "";
      position: absolute;
      bottom: 0;
      right: 0;
      left: 0;
      height: 12px;
      background: url("../../../assets/img/screen/radiance-small.png");
      transform: rotate(180deg);
    }
  }
  .body {
    position: relative;
    padding: 2px 0;
    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 10px;
      background: linear-gradient(to bottom, fade(#22334a, 40%) 0%, fade(#16273e, 10%) 70%, transparent 100%);
    }
    table {
      width: 100%;
      &::before {
        height: 10px;
        content: "";
        position: absolute;
        top: 30px;
        left: 0;
        right: 0;
        background: linear-gradient(to top, fade(#22334a, 40%) 0%, fade(#16273e, 10%) 70%, transparent 100%);
      }
      thead {
        display: table;
        max-width: 100%;
        min-width: 520px;
        th {
          padding: @padding-xs @padding-sm;
          font-weight: normal;
          position: relative;
          font-size: 16px;
          letter-spacing: 0.6em;
          &:first-child {
            width: 70%;
          }
          &:not(:first-child) {
            text-align: center;
            &::before {
              width: 10px;
              content: "";
              position: absolute;
              top: 0;
              bottom: 0;
              left: 0;
              right: 0;
              background: linear-gradient(to right, fade(#22334a, 40%) 0%, fade(#16273e, 10%) 70%, transparent 100%);
            }
          }
          &.name{
            text-indent: 20px;
          }
        }
      }
      tbody {
        display: block;
        max-height: 520px;
        overflow-y: auto;
        overflow-x: hidden;
        tr {
          width: 100%;
          min-width: 520px;
          display: table;
          table-layout: fixed;
          cursor: pointer;
          transition: all .3s;
          &:hover {
            background: fade(#307985, 20%);
          }
          &.active {
            background: fade(#307985, 40%);
          }
          td {
            padding: @padding-xs @padding-sm;
            font-size: 16px;
            font-weight: normal;
            &.name{
              text-indent: 20px;
            }
            &:not(:first-child) {
              position: relative;
              &:not(:first-child)::before {
                width: 10px;
                content: "";
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(to right, fade(#22334a, 40%) 0%, fade(#16273e, 10%) 70%, transparent 100%);
              }
            }
            &:first-child {
              width: 70%;
              white-space: nowrap;
              overflow-x: hidden;
              text-overflow: ellipsis;
            }
            &.grade {
              font-size: 16px;
              font-weight: bold;
              display: flex;
              align-items: center;
              justify-content: center;
              &.A {
                color: #33DBCD;
              }
              &.B {
                color: #E6AF67;
              }
              &.C {
                color: #CE6129;
              }
              & span {
                margin-left: 12px;
                display: inline-block;
                width: 5px;
              }
            }
          }
        }
      }
    }
  }
}
</style>
