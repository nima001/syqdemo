<template>
  <div class="table-page">
    <div class="title">
      <h1>{{text}}增加机构数：{{chartData.addnum}}</h1>
      <h1>{{text}}减少机构数：{{chartData.cutnum}}</h1>
    </div>
    <div class="query">
      <a-input
        style="width: 200px;"
        placeholder="组织名称"
        v-model="searchkey"
      >
      </a-input>
      <a-button style="margin-left: 16px;" type="primary" @click="onQuery">查询</a-button>
      <a-button style="margin-left: 16px;" @click="onReset">重置</a-button>
    </div>
    <div class="table">
      <a-table
        class="per-table"
        :rowKey="Math.random() + ''"
        :columns="columns"
        :dataSource="chartData.rows"
        :pagination="false"
        :loading="loading"
        >
      </a-table>
    </div>
    <div class="footer">
      <a-pagination
        v-if="chartData.rows && chartData.rows.length"
        showSizeChanger
        :showTotal="total => `总共：${total}条`"
        @showSizeChange="onShowSizeChange"
        :total="page.total"
        :pageSize="page.pagesize"
        v-model="page.pagenum"
        @change="onPageChange"
      />
    </div>
  </div>
</template>

<script>
import { Table, Pagination, Input, Button } from "ant-design-vue";
import { showError } from "@/framework/utils/index";
export default {
  name: 'TablePage',
  props: ['chartData', 'pagetype'],
  components: {
    ATable: Table,
    APagination: Pagination,
    AInput: Input,
    AButton: Button
  },
  data() {
    return {
      columns: null,
      loading: false,
      text: '',
      page: {
        pagesize: 10,
        pagenum: 1,
        total: 0
      },
      searchkey: null
    }
  },
  watch: {
    pagetype: {
      handler(val) {
        let arr = [];
        if(val == 3) {
          arr = [
            {
              title: '组织名称',
              dataIndex: 'orgname',
            },
            {
              title: '编制增加数',
              dataIndex: 'bzsincreasenum',
            },
            {
              title: '编制减少数',
              dataIndex: 'bzsreducenum',
            },
          ]
          this.text = '编制';
        }else{
          arr = [
            {
              title: '组织名称',
              dataIndex: 'orgname',
            },
            {
              title: '职数增加数',
              dataIndex: 'zsincreasenum',
            },
            {
              title: '职数减少数',
              dataIndex: 'zsreducenum',
            },
          ]
          this.text = '职数';
        }
        this.columns = arr;
      },
      immediate: true
    },
    chartData: {
      handler(val) {
        this.page = val;
      },
      immediate: true
    }
  },
  created() {
    this.loading = true;
  },
  mounted() {
    this.loading = false;
  },
  methods:{
    onShowSizeChange(pagenum, pagesize) {
      this.$emit('pageChange', {pagenum: 1, pagesize, needtotal: true});
    },
    onPageChange(pagenum, pagesize) {
      this.$emit('pageChange', {pagenum, pagesize, needtotal: true});
    },
    onQuery() {
      if(this.searchkey) {
        this.$emit('pageChange', {pagenum: 1, pagesize: 10, needtotal: true, searchkey: this.searchkey});
      }else{
        this.$message.warning("请输入组织名称");
      }
    },
    onReset() {
      this.searchkey = null;
      this.$emit('pageChange', {pagenum: 1, pagesize: 10, needtotal: true, searchkey: this.searchkey});
    }
  }
}
</script>

<style lang="less" scoped>
.table-page{
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -ms-flex-direction: column;
  flex-direction: column;
  overflow: hidden;
  height: 100%;
  background: @white;
  .title{
    h1{
      text-align: center;
    }
  }
  .query{
    display: flex;
    justify-content: flex-end;
    padding: @content-padding-v @content-padding-h; 
  }
  .table{
    flex-shrink: 1;
    overflow-y: auto;
    padding: @content-padding-v @content-padding-h;  
    .title{
      padding: @content-padding-h 0;
      text-align: center;
    }
  }
  .footer {
    padding: 12px @content-padding-h;
    .ant-pagination{
      float: right;
    }
  }
}
</style>