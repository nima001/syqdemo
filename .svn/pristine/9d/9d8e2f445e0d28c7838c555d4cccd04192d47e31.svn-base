<template>
  <div class="wrap">
    <ul class="title">
      <li>机构</li>
      <li>编制</li>
      <li>职数</li>
    </ul>
    <div class="content">
      <swiper-ant :size="formatList['length']">
        <ul
          class="list"
          v-for="(item,index) in formatList"
          :slot="'swiper'+`${index}`"
          :key="index"
        >
          <li class="item" v-for="(lg,idx) in item" :key="idx">
            <p class="tip">{{lg.name}}</p>
            <div class="liquid-spot">
              <liquid-spot :persent="lg.percent"></liquid-spot>
            </div>
          </li>
        </ul>
      </swiper-ant>
    </div>
  </div>
</template>

<script>
import liquidSpot from "../housekeeper/liquidSpot";
import SwiperAnt from "../components/SwiperAnt";
import { sliceArr } from "@/person-shaoxing/utils/index";
import { mixins } from "../components/minxin";
import { areaStatistics } from "@/person-shaoxing/api/orgStaffReport";
import { showError } from "@/framework/utils/index";

export default {
  components: { liquidSpot, SwiperAnt },
  data() {
    return {
      list: [
        { name: "行政机构限额", percent: 88 },
        { name: "行政编制限额", percent: 70 },
        { name: "行政领导职数核定", percent: 60 },
        { name: "行政机构限额", percent: 40 },
        { name: "行政编制限额", percent: 80 },
        { name: "行政领导职数核定", percent: 62 }
      ],
      fields: [
        "dzhgzl_xe", //党政机构限额
        "dzjgzl_sy", //党政机构实有
        "zgbzzl", //行政编制省定
        "hdxzbzqy", //行政编制核定数
        "hdldzsqy", //行政领导核定
        "hdldzsqy_sy", //行政领导实有

        "syjg_xe", //事业单位限额
        "syjg_sy", //事业单位实有
        "sybzzl", //事业编省定
        "hesybzqy", //事业核定编制数
        "syhdldzsqy", //事业领导核定
        "syhdldzsqy_sy" //事业领导实有
      ],
      countResult: {}
    };
  },
  mixins: [mixins],
  watch: {
    dictId(v) {
      this.getCount(v);
    }
  },
  mounted() {
    this.getCount(this.dictId);
  },
  computed: {
    formatList() {
      let one = this.countResult.dzjgzl_sy / this.countResult.dzhgzl_xe;
      let two = this.countResult.hdxzbzqy / this.countResult.zgbzzl;
      let three = this.countResult.hdldzsqy_sy / this.countResult.hdldzsqy;
      let four = this.countResult.syjg_sy / this.countResult.syjg_xe;
      let five = this.countResult.hesybzqy / this.countResult.sybzzl;
      let six = this.countResult.syhdldzsqy_sy / this.countResult.syhdldzsqy;

      let list = [
        { name: "行政机构限额", percent: one ? Math.round(one*100) : 0 },
        { name: "行政编制限额", percent: two ? Math.round(two*100) : 0 },
        { name: "行政领导职数核定", percent: three ? Math.round(three*100) : 0 },
        { name: "事业机构限额", percent: four ? Math.round(four*100) : 0 },
        { name: "事业编制限额", percent: five ? Math.round(five*100) : 0 },
        { name: "事业领导职数核定", percent: six ? Math.round(six*100) : 0 }
      ];
      return sliceArr(list, 3);
    }
  },
  methods: {
    getCount(dictId) {
      areaStatistics(dictId, this.fields)
        .then(res => {
          this.countResult = res.result;
        })
        .catch(err => {
          showError(err);
        });
    }
  }
};
</script>
<style lang='less' scoped>
.wrap {
  background: url("../img/long-line.png") center bottom no-repeat;
  padding-bottom: 25px;
  .title {
    margin: 0px;
    height: 65px;
    background: url("../img/dote.png") repeat;
    display: flex;
    li {
      flex: 1;
      text-align: center;
      line-height: 65px;
      width: 40px;
      font-size: 20px;
      font-family: Microsoft YaHei;
      font-weight: 400;
      color: #ffffff;
      opacity: 1;
    }
  }
  .content {
    width: 695px;
    position: relative;
    .list {
      display: flex;
      .item {
        flex: 1;
        .tip {
          font-size: 16px;
          font-family: Microsoft YaHei;
          font-weight: 400;
          line-height: 20px;
          color: #ffffff;
          opacity: 0.8;
          margin: 0px;
          text-align: center;
          padding: 16px 0px;
        }
        .liquid-spot {
          width: 120px;
          height: 120px;
          margin: 0 auto;
        }
      }
    }
  }
}
</style>